--1.
SELECT first_name, last_name, department_id
FROM employees e
WHERE salary < (
  SELECT AVG(salary)
  FROM employees
  WHERE department_id = e.department_id
);


--2.
SELECT first_name, last_name,
       CASE
         WHEN MONTHS_BETWEEN(SYSDATE, hire_date)/12 < 3 THEN 'Junior'
         WHEN MONTHS_BETWEEN(SYSDATE, hire_date)/12 <= 7 THEN 'Mid-Level'
         ELSE 'Senior'
       END nivel
FROM employees;

--3.
SELECT NVL(job_id,'TOTAL') job_id,
       NVL(TO_CHAR(department_id),'SUBTOTAL') department_id,
       COUNT(*) nr
FROM employees
GROUP BY ROLLUP(department_id, job_id);


--4.
SELECT manager_id, COUNT(*) nr
FROM employees
WHERE manager_id IS NOT NULL
GROUP BY manager_id
HAVING COUNT(*) >= 3;

--7.
SELECT first_name, last_name, LEVEL
FROM employees
START WITH employee_id = 101
CONNECT BY PRIOR employee_id = manager_id;

--8.
SELECT d.department_name, COUNT(*) nr
FROM employees e
JOIN departments d ON d.department_id = e.department_id
WHERE e.salary > (SELECT AVG(salary) FROM employees)
GROUP BY d.department_name
ORDER BY nr DESC;
